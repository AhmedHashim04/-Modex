import os
import random
from django.core.files.base import ContentFile
from django.core.management.base import BaseCommand
from product.models import Category
from slugify import slugify

# ๐ผ๏ธ ูุฌูุฏ ุงูุตูุฑ
IMAGE_DIR = "/home/ahmed/Desktop/project/src/media/image_pr"

# ๐ฆ ุงูุฏุงุชุง ุจุชุงุนุฉ ุงููุงุชูุฌูุฑูุฒ
CATEGORIES = {
    "ูุฏุงูุง ุญุณุจ ุงูููุงุณุจุฉ": [
        ("ุนูุฏ ูููุงุฏ", "ุงุญุชูู ูุน ูู ุชุญุจ ุจุฃุฌูู ุงููุฏุงูุง ุงููุฎุชุงุฑุฉ ุจุนูุงูุฉ ูุชูุงุณุจ ุฌููุน ุงูุฃุนูุงุฑ ูู ููููู ุงููููุฒ."),
        ("ุฑูุถุงู", "ุฒููุฉ ุฑูุถุงููุฉ ููุฏุงูุง ุชุนูุณ ุฑูุญ ุงูุดูุฑ ุงููุถูู ูุชูุดุฑ ุงูุฃุฌูุงุก ุงูุฑูุญุงููุฉ."),
        ("ุนูุฏ ุงูุฃู", "ุนุจูุฑ ุนู ุงูุชูุงูู ูุญุจู ูุฃูู ูุน ูุฏุงูุง ูุงุฎุฑุฉ ุชููู ุจููุงูุชูุง."),
        ("ุงุณูุงููุงุช", "ูุฏุงูุง ุฏูููุฉ ุชุนูุณ ุงูููู ุงูุงุณูุงููุฉ ูุชูุงุณุจ ุงูููุงุณุจุงุช ุงูุฏูููุฉ."),
        ("ุงูุนูุฏ", "ูุฏุงูุง ุจูุฌุฉ ุงูุนูุฏ ูููุณุงุช ุฃูููุฉ ุชุฏุฎู ุงูุณุฑูุฑ ุนูู ูููุจ ุฃุญุจุงุจู."),
    ],
    "ูุฏุงูุง ุญุณุจ ุงูุดุฎุต": [
        ("ููุฑุฌุงู", "ุงุฎุชูุงุฑุงุช ุนูููุฉ ููุฎูุฉ ุชูุงุณุจ ุงูุฑุฌู ุงูุนุตุฑู ูุชุนูุณ ุฐููู ูู ุงุฎุชูุงุฑ ุงููุฏุงูุง."),
        ("ูููุณุงุก", "ููุชุฌุงุช ุฑุงููุฉ ูุนุตุฑูุฉ ุชุถูู ููุณุฉ ุฃูุซููุฉ ุฑูููุฉ ูุชูุงุณุจ ุฌููุน ุงูุฃุฐูุงู."),
        ("ููุฃุทูุงู", "ูุฏุงูุง ููุชุนุฉ ูุชุนููููุฉ ุชุฌูุน ุจูู ุงููุฑุญ ูุงููุงุฆุฏุฉ ููุฃุทูุงู."),
    ],
    "ูุฏุงูุง ุญุณุจ ุงูููุน": [
        ("ุดููููุงุชุฉ", "ุฃูุฎู ุฃููุงุน ุงูุดููููุงุชุฉ ุงููุบููุฉ ุจุดูู ุฃูููุ ูุซุงููุฉ ููุฅูุฏุงุก."),
        ("ูุฑุฏ", "ุจุงูุงุช ูุฑุฏ ุทุจูุนูุฉ ูููุณููุฉ ุจุนูุงูุฉ ุชุถูู ููุณุฉ ุฑููุงูุณูุฉ ูุนุทุฑูุฉ."),
        ("ููุชุฌุงุช ูุทุจูุนุฉ", "ุฃููุงุจ ุจุชุตุงููู ูุฎุตุตุฉ ุชุนุจุฑ ุนู ุงูุดุฎุตูุฉ ูุงูููุงุณุจุฉ."),
    ],
    "ุฃุฌูุฒุฉ ููุฒููุฉ": [
        ("ุฃุฏูุงุช ูุทุจุฎ", "ููุชุฌุงุช ุชุณููู ุงูุทุจุฎ ูุชุญุณูู ุชุฌุฑุจุฉ ุงููุทุจุฎ ุจุงุญุชุฑุงู."),
        ("ุฃุฌูุฒุฉ ููุฑุจุงุฆูุฉ", "ูุนุฏุงุช ููุฑุจุงุฆูุฉ ุถุฑูุฑูุฉ ููู ููุฒู ุนุตุฑู ุจุฌูุฏุฉ ูุฃุฏุงุก ููุชุงุฒ."),
    ],
    "ููุชุฌุงุช ุดุฎุตูุฉ": [
        ("ุนุทูุฑ", "ุชุดูููุฉ ูู ุงูุนุทูุฑ ุงููููุฒุฉ ุจุฑูุงุฆุญ ุฌุฐุงุจุฉ ูุซุจุงุช ูุฏูู."),
        ("ุณุงุนุงุช", "ุณุงุนุงุช ุฃูููุฉ ุชุนูุณ ุงูุฐูู ูุชูุงุณุจ ูู ุงูููุงุณุจุงุช."),
        ("ูุธุงุฑุงุช ุดูุณ", "ูุธุงุฑุงุช ุชุญูู ุงูุนูู ูุชุถูู ููุณุฉ ูู ุงูุฃูุงูุฉ ูู ุขูู ูุงุญุฏ."),
    ],
    "ูุณุชูุฒูุงุช ููุชุจูุฉ": [
        ("ุฏูุงุชุฑ ูุฃุฌูุฏุงุช", "ุฃุฏูุงุช ุชูุธูู ููููุฉ ุจุชุตุงููู ุฃูููุฉ ูุชุญููุฒ ุงูุฅูุชุงุฌูุฉ."),
        ("ุฃููุงู ููุฏุงูุง ููุชุจูุฉ", "ุฃุฏูุงุช ููุชุจูุฉ ูุงุฎุฑุฉ ูุซุงููุฉ ููููุชุจ ุฃู ููุฏุงูุง ุนูููุฉ."),
    ],
    "ุฏูููุฑ ููุฒูู": [
        ("ููุญุงุช ูููุฉ", "ูุทุน ูููุฉ ุชุถูู ููุณุฉ ุฌูุงููุฉ ูุฃู ูุณุงุญุฉ ุฏุงุฎู ุงูููุฒู."),
        ("ุดููุน ูุนุทุฑุฉ", "ุดููุน ุจุฑูุงุฆุญ ุทุจูุนูุฉ ุชุจุนุซ ุนูู ุงูุฑุงุญุฉ ูุงูุณูููุฉ."),
        ("ูุฒูุฑูุงุช", "ุชุตุงููู ุฃูููุฉ ูุฅุจุฑุงุฒ ุฌูุงู ุงูุฒููุฑ ูุฅุถูุงุก ููุณุฉ ูุงุนูุฉ."),
        ("ุณุงุนุงุช ุญุงุฆุท", "ุชุตุงููู ููุฏุฑู ูููุงุณูููุฉ ุชูุณุฌู ูุน ูุฎุชูู ุงูุฏูููุฑุงุช."),
        ("ูุณุงุฆุฏ ุฒุฎุฑููุฉ", "ูุณุงุฆุฏ ุจุฃููุงู ููููุด ุฌุฐุงุจุฉ ุชุฒูุฏ ูู ุฃูุงูุฉ ุงูุฃุซุงุซ."),
        ("ูุตุงุจูุญ ูุทุงููุงุช ุฌุงูุจูุฉ", "ุฅุถุงุกุฉ ุฏุงูุฆุฉ ูุชุตุงููู ุนุตุฑูุฉ ูุฒูุงูุง ุงูููุฒู."),
        ("ุญุงูุธุงุช ุชูุธูู", "ุตูุงุฏูู ูุณูุงู ุฃูููุฉ ูุชุฑุชูุจ ุงููุณุงุญุงุช ุจุดูู ุฐูู."),
        ("ูุฑุงูุง ุฏูููุฑูุฉ", "ูุฑุงูุง ุชุถูู ุฅุญุณุงุณุงู ุจุงูุงุชุณุงุน ูุชุฒูุฏ ูู ุงูุฅุถุงุกุฉ."),
        ("ุณุชุงุฆุฑ ูุฅูุณุณูุงุฑุงุชูุง", "ุฃููุดุฉ ูุงุฎุฑุฉ ุจุฃููุงู ูุชูุงุณูุฉ ุชุนูุณ ุฐููู ุงูุฑููุน."),
        ("ูุจุงุชุงุช ุตูุงุนูุฉ", "ููุณุฉ ุฎุถุฑุงุก ูุง ุชุญุชุงุฌ ุนูุงูุฉุ ุชุถูู ุญูููุฉ ุนูู ุงูููุงู."),
    ],
    "ุฃูุนุงุจ ูุชุฑููู": [
        ("ุฃูุนุงุจ ููุญูุฉ", "ุฃูุนุงุจ ุฌูุงุนูุฉ ุชุถูู ุงููุฑุญ ูุงูุชุณููุฉ ููุฃุตุฏูุงุก ูุงูุนุงุฆูุฉ."),
        ("ุฃูุนุงุจ ุชุนููููุฉ", "ุฃูุนุงุจ ุชูููู ููุงุฑุงุช ุงูุชูููุฑ ูุงูุฅุจุฏุงุน ูุฏู ุงูุฃุทูุงู."),
        ("ุฃูุนุงุจ ุฅููุชุฑูููุฉ", "ุฃุฌูุฒุฉ ูุฃูุนุงุจ ุฑูููุฉ ุชุฏูุฌ ุจูู ุงูุชูููููุฌูุง ูุงููุฑุญ."),
        ("ุฃูุนุงุจ ุชุฑููุจ", "ุฃูุนุงุจ ุชูุงุนููุฉ ุชุนุชูุฏ ุนูู ุงูุชุฑููุจ ูุงูุจูุงุก ูุชุนุฒูุฒ ุงูุฐูุงุก ุงูุจุตุฑู."),
        ("ุฃูุนุงุจ ุฃุทูุงู ุตุบุงุฑ", "ุฃูุนุงุจ ุขููุฉ ูููุงุณุจุฉ ููุฃุทูุงู ูู ุฃุนูุงุฑ ูุจูุฑุฉ."),
        ("ุฃูุนุงุจ ุญุฑููุฉ", "ููุชุฌุงุช ุชุดุฌุน ุนูู ุงููุดุงุท ุงูุจุฏูู ูุงูุชูุงุนู ุงูุญุฑูู ุฏุงุฎู ุงูููุฒู ุฃู ุฎุงุฑุฌู."),
        ("ุฃูุนุงุจ ุฐููุฉ", "ุฃูุนุงุจ ุญุฏูุซุฉ ุชุนุชูุฏ ุนูู ุงูุชูููุฑ ุงูููุทูู ูุงูุฐูุงุก ุงูุงุตุทูุงุนู."),
    ],
    "ุฅููุชุฑูููุงุช": [
        ("ุณูุงุนุงุช", "ุฌูุฏุฉ ุตูุช ุนุงููุฉ ุจุชุตุงููู ูุฑูุญุฉ ูุฃุฏุงุก ูููุฒ."),
        ("ุจุงูุฑ ุจุงูู", "ุดุญู ูุชููู ููุซูู ูุญูุงูุฉ ุฃุฌูุฒุชู ูู ูู ููุงู."),
        ("ูุงุจูุงุช ูุดูุงุญู", "ููุญูุงุช ุดุญู ุฃุตููุฉ ูุณุฑูุนุฉ ูุฌููุน ุฃููุงุน ุงูุฃุฌูุฒุฉ."),
        ("ุณุงุนุงุช ุฐููุฉ", "ุชุงุจุน ูุดุงุทู ุงูุตุญู ูุงูุจูุงุก ุนูู ุงุชุตุงู ุจุฃูุงูุฉ."),
        ("ุฃุฌูุฒุฉ ุชุชุจุน", "ุญููู ุฐููุฉ ูุชุนููุจ ุงูุฃุดูุงุก ุงูุซูููุฉ ูุงููุฑูุจุงุช."),
        ("ููุจุฑุงุช ุตูุช ุจููุชูุซ", "ุชุฌุฑุจุฉ ุตูุชูุฉ ูุญูููุฉ ูุบุงูุฑุฉ ูู ุฃู ููุงู."),
        ("ุญูุงูู ููุซุจุชุงุช ููุงุชู", "ุซุจุงุช ูุณูููุฉ ุงุณุชุฎุฏุงู ุฃุซูุงุก ุงูููุงุฏุฉ ุฃู ุงูุชุตููุฑ."),
        ("ููุญุงุช ููุงุชูุญ ููุฃุฑุงุช", "ุฅูุณุณูุงุฑุงุช ููุชุจูุฉ ูุชุฌุฑุจุฉ ุงุณุชุฎุฏุงู ูุฑูุญุฉ ูููุชุฌุฉ."),
        ("ูุฑูุช ุฐุงูุฑุฉ ูููุงุดุงุช", "ุชุฎุฒูู ุจูุงูุงุช ุขูู ูุณุฑูุน ูุฌููุน ุงุญุชูุงุฌุงุชู."),
        ("ุฅุถุงุกุงุช LED ุฐููุฉ", "ุชุญููู ุจุงูุฅุถุงุกุฉ ุจุฃูุงูุฉ ุจุงุณุชุฎุฏุงู ุชุทุจููุงุช ุงููุงุชู."),
    ]
}


class Command(BaseCommand):
    help = "Seed categories and subcategories with random images"

    def handle(self, *args, **kwargs):
        def unique_slugify(base_slug):
            slug = base_slug
            counter = 1
            while Category.objects.filter(slug=slug).exists():
                slug = f"{base_slug}-{counter}"
                counter += 1
            return slug

        def get_random_image_file():
            images = [
                f for f in os.listdir(IMAGE_DIR)
                if f.lower().endswith(('.jpg', '.jpeg', '.png'))
            ]
            if not images:
                return None
            return os.path.join(IMAGE_DIR, random.choice(images))

        def add_random_image(category):
            image_path = get_random_image_file()
            if image_path and not category.image:
                with open(image_path, "rb") as f:
                    image_data = f.read()
                    file_name = os.path.basename(image_path)
                    django_file = ContentFile(image_data, name=file_name)
                    category.image.save(file_name, django_file, save=True)

        for parent_name, subcats in CATEGORIES.items():
            parent_cat, _ = Category.objects.get_or_create(
                name=parent_name,
                parent=None,
                defaults={
                    "description": f"ูุณู {parent_name} ูุญุชูู ุนูู ูุฌููุนุฉ ูุชููุนุฉ ูู ุงูููุชุฌุงุช ุนุงููุฉ ุงูุฌูุฏุฉ.",
                    "slug": unique_slugify(slugify(parent_name)),
                },
            )
            add_random_image(parent_cat)

            for name, description in subcats:
                cat, created = Category.objects.get_or_create(
                    name=name,
                    parent=parent_cat,
                    defaults={
                        "description": description,
                        "slug": unique_slugify(slugify(name)),
                    },
                )
                add_random_image(cat)

        self.stdout.write(self.style.SUCCESS("โ Categories (with random images) seeded successfully."))
